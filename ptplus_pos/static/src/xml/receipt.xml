<?xml version="1.0" encoding="UTF-8" ?>
<templates id="template" xml:space="preserve">
    <t
        t-name="OrderReceipt"
        t-inherit="point_of_sale.OrderReceipt"
        t-inherit-mode="extension"
        owl="1"
    >
        <xpath expr="//t[@t-if='receipt.company.contact_address']" position="before">
            <t t-if="!receipt.company.l10n_pt_invoicing">
                <div>
                    <t t-if="receipt.date.localestring">
                        <div>
                            <t t-esc="receipt.date.localestring" />
                        </div>
                    </t>
                    <t t-else="">
                        <div>
                            <t t-esc="receipt.date.validation_date" />
                        </div>
                    </t>
                </div>

                <div>
                    <span><t t-esc="receipt.l10n_pt_doc_name" /></span>
                </div>
                <br />
                <t t-log="receipt" />
            </t>
        </xpath>
        <xpath expr='//t[@t-if="receipt.company.vat"]' position="after">
            <div t-if="receipt.company.street"><t
                    t-esc="receipt.company.street"
                /></div>
            <div>
                <t t-if="receipt.company.zip"><t t-esc="receipt.company.zip" /> </t>
                <t t-if="receipt.company.city"><t t-esc="receipt.company.city" /> </t>
                <t t-if="receipt.company.state_id">(<t
                        t-esc="receipt.company.state_id[1]"
                    />)</t>
            </div>
        </xpath>
        <xpath expr='//t[@t-if="receipt.cashier"]' position="before">
            <t t-if="receipt.partner">
                <div>--------------------------------</div>
                <div>Customer: <t t-esc="receipt.partner.name" /></div>
                <t t-if="receipt.partner.vat">
                    <div><t t-esc="receipt.company.vat_label" />:<t
                            t-esc="receipt.partner.vat"
                        /></div>
                </t>
            </t>
        </xpath>
        <xpath expr="//t[@t-esc='tax.name']" position="after">
            <span> on <t t-esc="env.pos.format_currency(tax.base)" /></span>
        </xpath>
        <xpath expr="//div[hasclass('pos-receipt-order-data')]" position="attributes">
            <attribute name="t-if">!receipt.company.l10n_pt_invoicing</attribute>
        </xpath>

        <xpath expr="//div[hasclass('before-footer')]" position="before">
            <t t-if="!receipt.company.l10n_pt_invoicing">
                <t t-foreach="receipt.tax_details" t-as="tax" t-key="tax.name">
                    <div style="height: 0.7rem;">
                        <span
                            class="pt_vat_exemption_reason_description"
                            t-esc="tax.tax.l10n_pt_vat_exemption_reason_text or ''"
                        />
                    </div>
                </t>

                <div
                    id="pt_qrbox"
                    t-if="receipt.l10n_pt_qr_code or receipt.l10n_pt_bill_qr_code"
                >
                    <div id="atcud">
                        <span>ATCUD:</span>
                        <span t-esc="receipt.pt_atcud or receipt.l10n_pt_bill_atcud" />
                    </div>
                    <img
                        id="pt_qrcode"
                        t-att-src="receipt.l10n_pt_qr_code or receipt.l10n_pt_bill_qr_code"
                        class="pt_qrcode"
                    />
                </div>

                <br />
                <div class="pos-receipt-contact"><t
                        t-esc="receipt.l10n_pt_certification_text"
                    /></div>
                <br />

            </t>
        </xpath>

        <xpath expr="//t[@t-if='isTaxIncluded']/t" position="replace">
             <t t-if="!receipt.company.l10n_pt_invoicing">
                <t t-set="grouped_taxes" t-value="get_group_tax_by_name()" />
                <t t-foreach="grouped_taxes" t-as="pt_tax" t-key="pt_tax">
                    <div>
                        <t t-esc="pt_tax[0]" />
                        <span> </span>
                        <span class="pt_vat_exemption_reason" t-esc="pt_tax[2] or ''" />
                        <span
                            t-esc="env.pos.format_currency_no_symbol(pt_tax[1])"
                            class="pos-receipt-right-align"
                        />
                    </div>
                </t>
            </t>
            <t t-else="">
                <t t-foreach="receipt.tax_details" t-as="tax" t-key="tax.name">
                    <div>
                        <t t-esc="tax.name" />
                        <span
                            t-esc="env.pos.format_currency_no_symbol(tax.amount)"
                            class="pos-receipt-right-align"
                        />
                    </div>
                </t>
            </t>
        </xpath>


    </t>
</templates>
