<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="dataport_export_form_saft" model="ir.ui.view">
        <field name="name">dataport.export.form.saft</field>
        <field name="model">dataport.export.saft</field>
        <field name="type">form</field>
        <field name="inherit_id" ref="ptplus.dataport_export_form" />
        <field name="arch" type="xml">
            <field name="company_id" position="after">
                <field name="is_installed_accounting" invisible="1" />
                <field name="company_id" invisible="1" />
                <field
                    name="type"
                    attrs="{'invisible': [('is_installed_accounting', '=', False)]}"
                />
                <field name="l10n_pt_saft_computing_method" invisible="1" />
            </field>

            <field name="validate" position="attributes">
                <attribute
                    name="attrs"
                >{'invisible':['|', ('format','!=','xml'), ('l10n_pt_saft_computing_method', '!=', 'extraction')]}</attribute>
            </field>
            <field name="validate" position="after">
                <field
                    name="recompute_elements"
                    attrs="{'invisible': ['|', ('l10n_pt_saft_computing_method', '=', 'extraction'), ('state', '!=', 'select')]}"
                    help="Check this option if you want Odoo to ignore all the pre-computed SAF-T PT elements
                    (eg. invoices, taxes and products) and create/save new ones. Use it only if you believe
                    that the current software version will increase compliance. Otherwise the additional
                    time required for the exportation isn't worth it."
                />
                <field
                    name="exclude_pl_calc"
                    attrs="{'invisible': ['|', ('type', 'not in', ['C', 'I']), ('state', '!=', 'select')]}"
                />
            </field>

            <xpath expr="//group[@id='main_export_group']" position="after">
                <group />
                <group
                    name="warnings"
                    string="Expected Balance Checking"
                    attrs="{'invisible': ['|', ('type', 'not in', ['C', 'I']), ('state', '!=', 'select')]}"
                >
                    <span class="text-muted">
                        Please indicate if the following operations have been completed:
                    </span>
                    <group />
                    <div class="o_row">
                        <label for="is_after_pl_calculation" string="P/L Calculation" />
                        <field
                            name="is_after_pl_calculation"
                            widget="boolean_toggle"
                            attrs="{'readonly': [('exclude_pl_calc', '=', True)]}"
                        />
                        <label
                            class="ps-5"
                            for="is_after_inventory_transfers"
                            string="Inventory Transfers"
                        />
                        <field
                            name="is_after_inventory_transfers"
                            widget="boolean_toggle"
                        />
                    </div>
                </group>
            </xpath>

            <xpath expr="//group[@name='error_info']" position="after">
                <group
                    name="balance_warnings"
                    string="Expected Balance Checking Warnings"
                    attrs="{'invisible': ['|', ('balance_warnings', '=', False), ('state', '!=', 'done')]}"
                >
                    <field
                        name="balance_warnings"
                        readonly="1"
                        widget="html"
                        nolabel="1"
                        colspan="2"
                    />
                </group>
                <button
                    name="check_balance_warning_accounts"
                    string="View Details"
                    type="object"
                    class="btn-primary"
                    invisible="1"
                />
                <!--                    attrs="{'invisible': ['|', ('balance_warnings', '=', False), ('state', '!=', 'done')]}"-->
            </xpath>

            <xpath expr="//button[@name='export_xml']" position="after">
                <button
                    name="saft_export"
                    type="object"
                    class="oe_highlight"
                    string="Export"
                    attrs="{'invisible': [('l10n_pt_saft_computing_method', '=', 'extraction')]}"
                />
            </xpath>

        </field>
    </record>

    <record id="action_wizard_dataport_export_saft" model="ir.actions.act_window">
        <field name="name">Export SAF-T</field>
        <field name="res_model">dataport.export.saft</field>
        <field name="view_mode">form</field>
        <field name="binding_view_types">form</field>
        <field name="view_id" ref="dataport_export_form_saft" />
        <field name="target">new</field>
    </record>

    <menuitem
        id="menu_pt_dataport_export_saft"
        parent="l10n_pt.account_reports_pt_statements_menu"
        sequence="1"
        groups="account.group_account_invoice"
        action="action_wizard_dataport_export_saft"
    />

</odoo>
